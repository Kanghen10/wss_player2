<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSE Player - Offline Version</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        video {
            max-width: 100%;
            max-height: 100%;
            background: black;
        }
        #loading {
            position: absolute;
            color: white;
            font-size: 20px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="loading">Loading...</div>
    <video id="player" autoplay playsinline controls></video>

    <!-- Load local JS instead of remote -->
    <script src="./js/video-stream.js"></script>
    <script src="./js/video-rtc.js"></script>

    <script>
    (function() {
        let hash = decodeURIComponent(location.hash.substring(1));

        // Auto detect: if "src=" exists but no "&mode=", add mode=mse
        if (hash.includes("src=") && !hash.includes("mode=")) {
            if (!hash.includes("&")) {
                hash += "&mode=mse";
            } else {
                hash += "&mode=mse";
            }
            location.hash = "#" + hash;
            location.reload();
            return;
        }

        const video = document.getElementById('player');
        const loading = document.getElementById('loading');

        // Pastikan audio nyala
        video.muted = false;

        function startStream(url) {
            if (url.startsWith("wss://")) {
                // WebRTC / WebSocket
                if (typeof startWebRTC === 'function') {
                    startWebRTC(url, video);
                } else {
                    console.error("startWebRTC not found!");
                }
            } else if (url.startsWith("http")) {
                // MSE
                if (typeof startMSE === 'function') {
                    startMSE(url, video);
                } else {
                    console.error("startMSE not found!");
                }
            }
        }

        if (hash) {
            loading.textContent = "Loading stream...";
            startStream(hash);
        } else {
            loading.textContent = "No stream URL";
        }

        video.addEventListener('playing', () => {
            loading.style.display = 'none';
        });
    })();
    </script>
</body>
</html>
